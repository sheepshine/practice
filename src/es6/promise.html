<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
</head>
<body>

	<script type="text/javascript">
		var NanShen={
			'身高':180,
			'体重':80,
			'年薪':'200k',
			request:function(obj){
				if(Math.random()>0.5){
					obj.success();
				}else{
					obj.error();
				}
			}
		}

		// var Request=function(names,success){
		// 	var index=0,first=0;
		// 	var request=function(){
		// 		if(names[index]){
		// 			NanShen.request({
		// 				name:name[index],
		// 				success:function(){
		// 					first=0;
		// 					document.write("成功拿下"+names[index]+"<br />")
		// 					console.log("成功拿下"+names[index]);
		// 					index++;
		// 					request()
		// 				},
		// 				error:function(){
		// 					if(first==1){
		// 						document.write("依旧没能拿下" + names[index] + "，求婚失败<br />");
		// 						console.log("依旧没能拿下" + names[index] + "，求婚失败");    
  //                       		return;
		// 					}else{
		// 						document.write("没能拿下" + names[index] + "，再试一次<br />");
		// 						console.log("没能拿下" + names[index] + "，再试一次");
		// 					}
		// 					first=1;
		// 					request();
		// 				}
		// 			})
		// 		}else{
		// 			success()
		// 		}
		// 	}
		// 	request();
		// }

		var Request=function(name){
			return new Promise(function(resolve,reject){
				var failed=0,request=function(){
					NanShen.request({
						name:name,
						success:function(){
							console.log(name+'攻略成功!')
							failed=0;
							resolve()
						},
						error:function(){
							if(failed==0){
								console.log('第一次攻略'+name+'失败，重试一次');
								failed=1;
								request()
							}else{
								console.log("依然没有拿下" + name + "，求婚失败！");
                        		reject();
							}
						}
					})
				}

				request()
			})
			// var index=0,first=0;
			// var request=function(){
			// 	if(names[index]){
			// 		NanShen.request({
			// 			name:name[index],
			// 			success:function(){
			// 				first=0;
			// 				document.write("成功拿下"+names[index]+"<br />")
			// 				console.log("成功拿下"+names[index]);
			// 				index++;
			// 				request()
			// 			},
			// 			error:function(){
			// 				if(first==1){
			// 					document.write("依旧没能拿下" + names[index] + "，求婚失败<br />");
			// 					console.log("依旧没能拿下" + names[index] + "，求婚失败");    
   //                      		return;
			// 				}else{
			// 					document.write("没能拿下" + names[index] + "，再试一次<br />");
			// 					console.log("没能拿下" + names[index] + "，再试一次");
			// 				}
			// 				first=1;
			// 				request();
			// 			}
			// 		})
			// 	}else{
			// 		success()
			// 	}
			// }
			// request();
		}

		console.log(Request("岳父"))
		Request("岳父").then(function(){
			alert(11)
		})
		// Request(["岳父", "大伯", "大姑"], function() {
		//     NanShen.request({
		//         name: "女神",
		//         success: function() {
		//         	document.write("女神同意，求婚成功！");
		//             console.log("女神同意，求婚成功！");
		//         },
		//         error: function() {
		//         	document.write("女神不同意，求婚失败！");
		//             console.log("女神不同意，求婚失败！");
		//         }
		//     });
		// });
	</script>
</body>
</html>